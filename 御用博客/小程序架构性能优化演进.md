# 小程序架构演进（网络层）

prelink机制：类似webview的链接复用机制，在同域名下服用第一个链接

网络请求优化：同步webview的网络库，okhttp——》chrome net；
网络对象转JS对象，避免NA序列化

FMP延迟网络请求，将广告等模块加入延时队列（加入前判断FMP是否结束），并间隔触发防止阻塞，实现调度器按请求优先级分批请求非核心请求

云加速同步到百度服务器进行数据缓存

流式下载安装，网络下载的同时执行保存文件，签名校验，解压解密等IO操作

域名同步，跟百度app复用链接

心跳机制同步配置，冷启时开启，后台时停止，再次吊起时判断间隔（5min）,判断逻辑：超时/有请求发出但updatecore未获取到最新值

竞争重试机制：第一次请求失败后重试，重试时使用双发机制跟保底请求一起发送，确保返回结果

弱网切换quic协议

解决证书校验耗时：开启图片白名单（协议降级），懒加载，预取图片

双联路优化：关键请求时进行网络探测，弱网时切换到4G