大家好，我是小小蒙，准大三，非正式前端

axios，一个用于网络请求的库，这应该是绝大多数前端项目都会用到的库了。最开始我们可以按照官方文档上的教程，直接引入调用即可。

但而随着我们项目规模的庞大，直接使用axios已经不能满足我们的需求了。毕竟谁也不想在业务层里写一大坨网络请求的代码，或者当项目上线时把上百个接口的测试环境地址一个一个改为生产环境地址。包括如果后端配置了token或者auth,在每个接口上一个一个添加更是一场灾难

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/589c1db79f754512a81350965e9cd338~tplv-k3u1fbpfcp-watermark.image?)

因此，面对庞大的项目，封装axios是我们必须要做的一件事情，今天我就来带大家，封装一个功能完整的axios

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/337a02c9b94442f6992c18ce18f2b6c2~tplv-k3u1fbpfcp-watermark.image?)

## 直接使用axios存在的问题？

在进行封装之前，我们必须明确，在项目中直接使用axios中存在哪些问题或者不足，这样才能对症下药

我稍微总结了一下，将axios直接在项目中使用的问题大概有这么几个：

* 请求代码分散在业务层，无法集中管理
* 对于token，auth，timeout，baseurl这些配置无法统一设置
* 每次拿到响应报文后需要response.data获取后端传过来的数据
* 无法区分开发和生产环境，导致当环境变化时需要手动更换接口
* 当请求方式不是默认请求头时，需要手动添加请求头配置
* 使用formData,urlencoded类型参数需要做额外处理
* 没有统一错误处理机制
* 当用户连续进行请求时，会消耗大量性能并可能导致信息提交重复
* 请求过程中没有给用户反馈，用户体验不好
* 请求失败后无法进行重连
* ....

那么，我们的封装就应该着眼于解决上面的这些问题

## 封装的功能

针对上面的问题，我们就可以分析出解决的方式,并得出最后封装出的功能：
* 将api抽离，分离业务层和请求层
* 设置了统一配置并区分开发生成环境
* 添加了请求，响应拦截器，直接返回响应信息的 data
* 对各种类型的错误进行了统一处理
* 自动取消短时间内发出的连续请求
* 统一参数配置，不论是json,formdata还是urlencoded，我们data都只需要传一个对象即可
* 根据参数配置请求头
* 在请求响应前添加loading动画，优化用户体验
* 支持重连机制


